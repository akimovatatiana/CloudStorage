{% extends 'base.html' %}
{% load static %}


{% block javascript %}
    <script src="{% static 'js/jquery-file-upload/vendor/jquery.ui.widget.js' %}"></script>
    <script src="{% static 'js/jquery-file-upload/jquery.iframe-transport.js' %}"></script>
    <script src="{% static 'js/jquery-file-upload/jquery.fileupload.js' %}"></script>

    <script src="{% static 'js/file-upload/drag-and-drop-upload.js' %}"></script>
{% endblock %}

{% block main %}
    <div>
        <div class="well text-muted text-center" style="padding-top: 4rem; padding-bottom: 4rem;">
            <span class="glyphicon glyphicon-arrow-down" style="font-size: 4rem;"></span>
            <h3>Drop Photos Here to Upload</h3>
        </div>

        <button type="button" class="btn btn-primary js-upload-files">
            <span class="glyphicon glyphicon-cloud-upload">Upload files</span>
        </button>
        <input id="fileupload" type="file" name="file" multiple
               style="display: none;"
               data-url="{% url 'upload' %}"
               data-form-data='{"csrfmiddlewaretoken": "{{ csrf_token }}", "user": "{{ user.id }}"}'>

        <table id="files-list" class="table table-striped">
            <thead class="thead-light">
            <tr>
                <th scope="col">Preview</th>
                <th scope="col">Filename</th>
                <th scope="col">Uploaded at</th>
                <th scope="col">Size</th>
                <th scope="col">Action</th>
            </tr>
            </thead>
            <tbody>
            {% for file in files %}
                <tr>
                    <td>
                        {% with extensions='.jpg .png .gif .jpeg .heic' %}
                            {% if file.extension in extensions %}
                                <img width="100px" height="100px" src="../..{{ file.file.url }}"/>
                            {% else %}
                                <img width="100px" height="100px" src="../../static/image/default_file_icon.gif">
                            {% endif %}
                        {% endwith %}
                    </td>
                    <td><a href="{{ file.file.url }}">{{ file.title }} {{ file.file.content_type }}</a></td>
                    <td><span>{{ file.uploaded_at }}</span></td>
                    <td><span>{{ file.size }}</span></td>
                    <td>
                        <div>
                            <form action="{% url 'remove-file' %}" method="POST">
                                {% csrf_token %}

                                <button class="btn btn-danger" type="submit">Delete</button>
                                <input type="hidden" name="pk" value="{{ file.pk }}">
                            </form>
                            <a href="{{ file.file.url }}" download>
                                <button class="btn btn-primary" type="submit">Download</button>
                            </a>
                        </div>
                    <td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}